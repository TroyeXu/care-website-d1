import{M as G,ag as W,ah as X,S as Z,v as ee,u as te,y as oe,z as le,A as v,R as se,a1 as ae,ai as ne,q as ie,p as re,c as C,o as c,w as a,e as l,a as s,J as _,l as u,j as ue,f as ce,aj as de,b as me,d as _e,D as pe,ak as ve,t as q,K as T,L as A,C as L,al as b,ae as fe,n as ge,am as N,_ as ye}from"./DLx3-ifv.js";import{u as xe}from"./Bs_-0E3x.js";import{C as he}from"./C-s1-Qrp.js";import{_ as qe}from"./Yqo6pqZJ.js";import{_ as be}from"./C5go2q6Y.js";import{_ as ke}from"./BFiq8LBz.js";import{_ as Se}from"./CSiiy5fn.js";const Ce='<circle cx="50" cy="50" r="44" fill="none" stroke-width="4" stroke-opacity=".5" stroke="currentColor"></circle><circle cx="8" cy="54" r="6" fill="currentColor" stroke-width="3" stroke="currentColor"><animateTransform attributeName="transform" type="rotate" from="0 50 48" to="360 50 52" dur="2s" repeatCount="indefinite"></animateTransform></circle>',we=G({name:"QSpinnerOrbit",props:W,setup(w){const{cSize:m,classes:f}=X(w);return()=>Z("svg",{class:f.value,width:m.value,height:m.value,viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid",xmlns:"http://www.w3.org/2000/svg",innerHTML:Ce})}}),Re={class:"row justify-center"},Ve={class:"col-12 col-lg-10"},Me={class:"row items-center justify-between q-mb-lg"},He={class:"text-h5 text-primary"},$e={class:"row q-gutter-md"},ze={class:"col-12 col-sm-6 col-md-4"},Te={class:"col-12 col-sm-6 col-md-4"},Ae={class:"col-12 col-sm-6 col-md-4"},Le={class:"row q-gutter-md q-mt-md"},Ne={class:"col-12"},Pe={class:"row q-gutter-md q-mt-md"},Ue={class:"col"},je={class:"col-auto"},Be={key:0,class:"text-center q-pa-lg"},Oe={key:1,class:"text-center q-pa-lg"},De={key:2},Fe={class:"text-h6 text-primary"},Ie={class:"caregiver-list"},Je={class:"row items-center justify-between q-mb-sm"},Qe={class:"q-mt-md"},Ee={class:"text-body2"},Ke={key:3},Ye=ee({__name:"match",setup(w){te("智能媒合 - 護理服務平台","根據您的需求智能推薦最適合的看護師");const m=oe(),f=xe(),P=le(),d=v([]),g=v(!1),k=v(!1),y=v(!1),t=v({location:"",maxHourlyRate:null,minRating:null,requiredSkills:[]}),U=[{label:"台北市",value:"台北"},{label:"新北市",value:"新北"},{label:"桃園市",value:"桃園"},{label:"台中市",value:"台中"},{label:"台南市",value:"台南"},{label:"高雄市",value:"高雄"}],j=["專業照護","失智症照護","復健協助","夜間照護","用藥管理","營養調理","心理支持","物理治療","語言治療","職能治療"],R=se(()=>t.value.location||t.value.maxHourlyRate!==null||t.value.minRating!==null||t.value.requiredSkills.length>0),V=async()=>{g.value=!0,k.value=!0;try{let o=[];if(R.value)o=await f.filterCaregivers({...t.value,...t.value.maxHourlyRate&&{maxHourlyRate:t.value.maxHourlyRate},...t.value.minRating&&{minRating:t.value.minRating}});else{const i=await f.getFeaturedCaregivers();o=Array.isArray(i)?i:i.data||[]}const e=o.map(i=>({...i,matchScore:B(i)}));d.value=e.sort((i,r)=>(r.matchScore||0)-(i.matchScore||0)).slice(0,8),d.value.length===0?m.notify({type:"info",message:"沒有找到符合條件的看護師，請調整媒合條件",timeout:3e3}):m.notify({type:"positive",message:`媒合成功！找到 ${d.value.length} 位推薦看護師`,timeout:2e3})}catch(o){console.error("媒合失敗:",o),m.notify({type:"negative",message:o.message||"媒合失敗，請稍後再試",timeout:3e3})}finally{g.value=!1}},B=o=>{let e=.5;if(e+=o.rating/5*.3,t.value.location&&o.location?.includes(t.value.location)&&(e+=.25),t.value.requiredSkills.length>0){const i=t.value.requiredSkills.filter(r=>o.skills.toLowerCase().includes(r.toLowerCase()));e+=i.length/t.value.requiredSkills.length*.25}return t.value.maxHourlyRate&&o.hourly_rate<=t.value.maxHourlyRate&&(e+=.2),Math.min(e,1)},O=o=>{const e=[];if(o.rating>=4.5&&e.push("高評分"),t.value.location&&o.location?.includes(t.value.location)&&e.push("地區匹配"),t.value.requiredSkills.length>0){const i=t.value.requiredSkills.filter(r=>o.skills.toLowerCase().includes(r.toLowerCase()));i.length>0&&e.push(`具備${i.length}項所需技能`)}return t.value.maxHourlyRate&&o.hourly_rate<=t.value.maxHourlyRate&&e.push("價格合理"),o.experience.includes("專業")&&e.push("專業經驗"),e.length>0?e:["推薦看護師"]},D=o=>o>=.8?"positive":o>=.6?"warning":"info",M=()=>{t.value={location:"",maxHourlyRate:null,minRating:null,requiredSkills:[]},d.value=[],k.value=!1},F=o=>{if(!P.currentUser){m.notify({type:"warning",message:"請先登入才能進行預約",timeout:3e3}),b("/auth/login");return}b({path:"/booking/create",query:{caregiverId:o.id}})};ae(()=>{V()});const{$route:I}=ne(),J=ie().public.baseUrl||"";return re({script:[{type:"application/ld+json",children:JSON.stringify({"@context":"https://schema.org","@type":"SearchResultsPage",name:"智能媒合 - 護理服務平台",url:J+I.fullPath,description:"根據您的需求智能推薦最適合的看護師",provider:{"@type":"Organization",name:"護理服務平台"}})}]}),(o,e)=>{const i=ue,r=ce,H=be,$=pe,x=_e,h=me,Q=qe,E=we,S=ke,K=ge,Y=Se;return c(),C(Y,{class:"q-pa-md"},{default:a(()=>[l("div",Re,[l("div",Ve,[l("div",Me,[l("div",He,[s(i,{name:"psychology",size:"md",class:"q-mr-sm"}),e[6]||(e[6]=u(" 智能媒合推薦 ",-1))]),s(r,{flat:"",icon:"tune",onClick:e[0]||(e[0]=n=>y.value=!y.value),color:R.value?"primary":"grey"},{default:a(()=>e[7]||(e[7]=[u(" 偏好設定 ",-1)])),_:1,__:[7]},8,["color"])]),s(Q,null,{default:a(()=>[de(s(h,{flat:"",bordered:"",class:"q-mb-lg"},{default:a(()=>[s(x,null,{default:a(()=>[e[10]||(e[10]=l("div",{class:"text-h6 q-mb-md"},"媒合偏好",-1)),l("div",$e,[l("div",ze,[s(H,{modelValue:t.value.location,"onUpdate:modelValue":e[1]||(e[1]=n=>t.value.location=n),options:U,label:"希望服務地區",outlined:"",dense:"",clearable:"","emit-value":"","map-options":""},null,8,["modelValue"])]),l("div",Te,[s($,{modelValue:t.value.maxHourlyRate,"onUpdate:modelValue":e[2]||(e[2]=n=>t.value.maxHourlyRate=n),modelModifiers:{number:!0},type:"number",label:"最高時薪預算",outlined:"",dense:"",min:"0",suffix:"元/小時"},null,8,["modelValue"])]),l("div",Ae,[s($,{modelValue:t.value.minRating,"onUpdate:modelValue":e[3]||(e[3]=n=>t.value.minRating=n),modelModifiers:{number:!0},type:"number",label:"最低評分要求",outlined:"",dense:"",min:"1",max:"5",step:"0.1"},null,8,["modelValue"])])]),l("div",Le,[l("div",Ne,[s(H,{modelValue:t.value.requiredSkills,"onUpdate:modelValue":e[4]||(e[4]=n=>t.value.requiredSkills=n),options:j,label:"需要的專業技能",outlined:"",dense:"",multiple:"","use-chips":"",clearable:""},null,8,["modelValue"])])]),l("div",Pe,[l("div",Ue,[s(r,{flat:"",color:"grey",onClick:M},{default:a(()=>e[8]||(e[8]=[u(" 清除偏好 ",-1)])),_:1,__:[8]})]),l("div",je,[s(r,{color:"primary",onClick:V,loading:g.value},{default:a(()=>e[9]||(e[9]=[u(" 重新媒合 ",-1)])),_:1,__:[9]},8,["loading"])])])]),_:1,__:[10]})]),_:1},512),[[ve,y.value]])]),_:1}),g.value?(c(),_("div",Be,[s(E,{size:"50px",color:"primary"}),e[11]||(e[11]=l("div",{class:"text-body2 q-mt-md"},"智能媒合中...",-1))])):d.value.length===0&&k.value?(c(),_("div",Oe,[s(i,{name:"search_off",size:"80px",color:"grey-5"}),e[13]||(e[13]=l("div",{class:"text-h6 q-mt-md text-grey-7"},"沒有找到符合條件的看護師",-1)),e[14]||(e[14]=l("div",{class:"text-body2 text-grey-6 q-mt-sm"}," 請嘗試調整您的媒合偏好或擴大搜尋範圍 ",-1)),s(r,{flat:"",color:"primary",onClick:M,class:"q-mt-md"},{default:a(()=>e[12]||(e[12]=[u(" 重設條件 ",-1)])),_:1,__:[12]})])):d.value.length>0?(c(),_("div",De,[s(h,{flat:"",bordered:"",class:"q-mb-md"},{default:a(()=>[s(x,{class:"text-center"},{default:a(()=>[l("div",Fe," 找到 "+q(d.value.length)+" 位符合條件的看護師 ",1),e[15]||(e[15]=l("div",{class:"text-body2 text-grey-6"}," 以下是根據您的需求精心篩選的推薦 ",-1))]),_:1,__:[15]})]),_:1}),l("div",Ie,[(c(!0),_(T,null,A(d.value,(n,z)=>(c(),_("div",{key:n.id,class:"match-card"},[s(h,{flat:"",bordered:"",class:"full-height cursor-pointer",onClick:p=>("navigateTo"in o?o.navigateTo:L(b))(`/caregivers/${n.id}`)},{default:a(()=>[s(x,null,{default:a(()=>[l("div",Je,[s(S,{color:D(n.matchScore||0),"text-color":"white",size:"sm"},{default:a(()=>[u(" 媒合度 "+q(Math.round((n.matchScore||0)*100))+"% ",1)]),_:2},1032,["color"]),z<3?(c(),C(S,{key:0,color:"orange","text-color":"white",size:"sm"},{default:a(()=>[u(" 第 "+q(z+1)+" 推薦 ",1)]),_:2},1024)):fe("",!0)]),s(he,{caregiver:n},null,8,["caregiver"]),l("div",Qe,[e[16]||(e[16]=l("div",{class:"text-caption text-grey-6 q-mb-xs"},"推薦原因：",-1)),l("div",Ee,[(c(!0),_(T,null,A(O(n),p=>(c(),C(S,{key:p,size:"sm",outline:"",color:"primary",class:"q-mr-xs q-mb-xs"},{default:a(()=>[u(q(p),1)]),_:2},1024))),128))])])]),_:2},1024),s(K,{align:"right"},{default:a(()=>[s(r,{flat:"",color:"primary",onClick:N(p=>("navigateTo"in o?o.navigateTo:L(b))(`/caregivers/${n.id}`),["stop"])},{default:a(()=>e[17]||(e[17]=[u(" 查看詳情 ",-1)])),_:2,__:[17]},1032,["onClick"]),s(r,{color:"primary",onClick:N(p=>F(n),["stop"])},{default:a(()=>e[18]||(e[18]=[u(" 立即預約 ",-1)])),_:2,__:[18]},1032,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"])]))),128))])])):(c(),_("div",Ke,[s(h,{flat:"",bordered:""},{default:a(()=>[s(x,{class:"text-center"},{default:a(()=>[e[20]||(e[20]=l("div",{class:"text-h6 q-mb-md"},"歡迎使用智能媒合服務",-1)),e[21]||(e[21]=l("div",{class:"text-body2 text-grey-6 q-mb-md"}," 設定您的偏好條件，我們將為您推薦最適合的看護師 ",-1)),s(r,{color:"primary",icon:"psychology",onClick:e[5]||(e[5]=n=>y.value=!0)},{default:a(()=>e[19]||(e[19]=[u(" 開始媒合 ",-1)])),_:1,__:[19]})]),_:1,__:[20,21]})]),_:1})]))])])]),_:1})}}}),st=ye(Ye,[["__scopeId","data-v-0a234703"]]);export{st as default};
