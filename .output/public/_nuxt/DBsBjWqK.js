import{M as be,aw as xe,N as he,P as qe,O as ke,R as u,A as V,ax as Se,Z as ee,ay as ne,az as we,aA as Ve,S as L,D as ie,f as re,v as Ce,u as Pe,av as Be,y as Re,z as De,a1 as Ne,ai as $e,q as ze,p as Fe,c as M,o as _,w as d,e as s,a as n,J as w,l as b,j as Te,b as Le,d as Me,t as p,m as Ue,K as le,L as oe,ae as I,g as je,h as Ae,i as Oe,k as Ee,aB as Ie,C as se,am as Ke,al as Je}from"./DLx3-ifv.js";import{u as Qe}from"./Bs_-0E3x.js";import{_ as We}from"./C5go2q6Y.js";import{_ as He}from"./DEJKBJhL.js";import{_ as Ze}from"./BPJMsbgl.js";import{_ as Ge}from"./DlcMHTQ2.js";import{_ as Xe}from"./BFiq8LBz.js";import{_ as Ye}from"./BCeXGjXm.js";import{_ as et}from"./CSiiy5fn.js";function K(t,$){return[!0,!1].includes(t)?t:$}const tt=be({name:"QPagination",props:{...he,modelValue:{type:Number,required:!0},min:{type:[Number,String],default:1},max:{type:[Number,String],required:!0},maxPages:{type:[Number,String],default:0,validator:t=>(typeof t=="string"?parseInt(t,10):t)>=0},inputStyle:[Array,String,Object],inputClass:[Array,String,Object],size:String,disable:Boolean,input:Boolean,iconPrev:String,iconNext:String,iconFirst:String,iconLast:String,toFn:Function,boundaryLinks:{type:Boolean,default:null},boundaryNumbers:{type:Boolean,default:null},directionLinks:{type:Boolean,default:null},ellipses:{type:Boolean,default:null},ripple:{type:[Boolean,Object],default:null},round:Boolean,rounded:Boolean,flat:Boolean,outline:Boolean,unelevated:Boolean,push:Boolean,glossy:Boolean,color:{type:String,default:"primary"},textColor:String,activeDesign:{type:String,default:"",values:t=>t===""||xe.includes(t)},activeColor:String,activeTextColor:String,gutter:String,padding:{type:String,default:"3px 2px"}},emits:["update:modelValue"],setup(t,{emit:$}){const{proxy:x}=qe(),{$q:v}=x,R=ke(t,v),i=u(()=>parseInt(t.min,10)),m=u(()=>parseInt(t.max,10)),C=u(()=>parseInt(t.maxPages,10)),k=u(()=>h.value+" / "+m.value),D=u(()=>K(t.boundaryLinks,t.input)),y=u(()=>K(t.boundaryNumbers,!t.input)),c=u(()=>K(t.directionLinks,t.input)),z=u(()=>K(t.ellipses,!t.input)),P=V(null),h=u({get:()=>t.modelValue,set:o=>{if(o=parseInt(o,10),t.disable||isNaN(o))return;const e=Se(o,i.value,m.value);t.modelValue!==e&&$("update:modelValue",e)}});ee(()=>`${i.value}|${m.value}`,()=>{h.value=t.modelValue});const U=u(()=>"q-pagination row no-wrap items-center"+(t.disable===!0?" disabled":"")),F=u(()=>t.gutter in ne?`${ne[t.gutter]}px`:t.gutter||null),J=u(()=>F.value!==null?`--q-pagination-gutter-parent:-${F.value};--q-pagination-gutter-child:${F.value}`:null),S=u(()=>{const o=[t.iconFirst||v.iconSet.pagination.first,t.iconPrev||v.iconSet.pagination.prev,t.iconNext||v.iconSet.pagination.next,t.iconLast||v.iconSet.pagination.last];return v.lang.rtl===!0?o.reverse():o}),Q=u(()=>({"aria-disabled":t.disable===!0?"true":"false",role:"navigation"})),T=u(()=>we(t,"flat")),W=u(()=>({[T.value]:!0,round:t.round,rounded:t.rounded,padding:t.padding,color:t.color,textColor:t.textColor,size:t.size,ripple:t.ripple!==null?t.ripple:!0})),j=u(()=>{const o={[T.value]:!1};return t.activeDesign!==""&&(o[t.activeDesign]=!0),o}),H=u(()=>({...j.value,color:t.activeColor||t.color,textColor:t.activeTextColor||t.textColor})),B=u(()=>{let o=Math.max(C.value,1+(z.value?2:0)+(y.value?2:0));const e={pgFrom:i.value,pgTo:m.value,ellipsesStart:!1,ellipsesEnd:!1,boundaryStart:!1,boundaryEnd:!1,marginalStyle:{minWidth:`${Math.max(2,String(m.value).length)}em`}};return C.value&&o<m.value-i.value+1&&(o=1+Math.floor(o/2)*2,e.pgFrom=Math.max(i.value,Math.min(m.value-o+1,t.modelValue-Math.floor(o/2))),e.pgTo=Math.min(m.value,e.pgFrom+o-1),y.value&&(e.boundaryStart=!0,e.pgFrom++),z.value&&e.pgFrom>i.value+(y.value?1:0)&&(e.ellipsesStart=!0,e.pgFrom++),y.value&&(e.boundaryEnd=!0,e.pgTo--),z.value&&e.pgTo<m.value-(y.value?1:0)&&(e.ellipsesEnd=!0,e.pgTo--)),e});function A(o){h.value=o}function Z(o){h.value=h.value+o}const G=u(()=>{function o(){h.value=P.value,P.value=null}return{"onUpdate:modelValue":e=>{P.value=e},onKeyup:e=>{Ve(e,13)===!0&&o()},onBlur:o}});function q(o,e,a){const r={"aria-label":e,"aria-current":"false",...W.value,...o};return a===!0&&Object.assign(r,{"aria-current":"true",...H.value}),e!==void 0&&(t.toFn!==void 0?r.to=t.toFn(e):r.onClick=()=>{A(e)}),L(re,r)}return Object.assign(x,{set:A,setByOffset:Z}),()=>{const o=[],e=[];let a;if(D.value===!0&&(o.push(q({key:"bls",disable:t.disable||t.modelValue<=i.value,icon:S.value[0],"aria-label":v.lang.pagination.first},i.value)),e.unshift(q({key:"ble",disable:t.disable||t.modelValue>=m.value,icon:S.value[3],"aria-label":v.lang.pagination.last},m.value))),c.value===!0&&(o.push(q({key:"bdp",disable:t.disable||t.modelValue<=i.value,icon:S.value[1],"aria-label":v.lang.pagination.prev},t.modelValue-1)),e.unshift(q({key:"bdn",disable:t.disable||t.modelValue>=m.value,icon:S.value[2],"aria-label":v.lang.pagination.next},t.modelValue+1))),t.input!==!0){a=[];const{pgFrom:r,pgTo:N,marginalStyle:f}=B.value;if(B.value.boundaryStart===!0){const g=i.value===t.modelValue;o.push(q({key:"bns",style:f,disable:t.disable,label:i.value},i.value,g))}if(B.value.boundaryEnd===!0){const g=m.value===t.modelValue;e.unshift(q({key:"bne",style:f,disable:t.disable,label:m.value},m.value,g))}B.value.ellipsesStart===!0&&o.push(q({key:"bes",style:f,disable:t.disable,label:"…",ripple:!1},r-1)),B.value.ellipsesEnd===!0&&e.unshift(q({key:"bee",style:f,disable:t.disable,label:"…",ripple:!1},N+1));for(let g=r;g<=N;g++)a.push(q({key:`bpg${g}`,style:f,disable:t.disable,label:g},g,g===t.modelValue))}return L("div",{class:U.value,...Q.value},[L("div",{class:"q-pagination__content row no-wrap items-center",style:J.value},[...o,t.input===!0?L(ie,{class:"inline",style:{width:`${k.value.length/1.5}em`},type:"number",dense:!0,value:P.value,disable:t.disable,dark:R.value,borderless:!0,inputClass:t.inputClass,inputStyle:t.inputStyle,placeholder:k.value,min:i.value,max:m.value,...G.value}):L("div",{class:"q-pagination__middle row justify-center"},a),...e])])}}}),at={class:"row justify-center"},nt={class:"col-12 col-lg-10"},lt={class:"row items-center justify-between q-mb-lg"},ot={class:"text-h5 text-primary"},st={class:"row q-gutter-sm"},it={class:"row items-center justify-center q-gutter-lg"},rt={class:"text-center"},ut={class:"text-h4 text-primary"},dt={class:"text-caption text-grey-6 q-mt-xs"},ct={class:"col"},mt={class:"text-caption q-mr-sm"},vt={class:"text-caption",style:{"min-width":"30px"}},gt={key:0,class:"text-center q-pa-lg"},_t={key:1},pt={class:"text-caption text-grey-6"},yt={key:0},ft={key:0,class:"bg-grey-1 q-pa-md q-mt-sm rounded-borders"},bt={class:"text-caption text-grey-7 q-mb-xs"},xt={class:"text-body2"},ht={class:"text-right"},qt={key:0,class:"text-center q-mt-md"},kt={key:2,class:"text-center q-pa-lg"},St={class:"text-body2 text-grey-6"},wt={class:"text-h6 q-mb-md"},Vt={class:"row q-gutter-md"},Ct={class:"col-12 col-sm-6"},Pt={class:"col-12 col-sm-6"},Bt={class:"row items-center q-gutter-md"},Rt={class:"text-caption text-grey-6"},Dt={class:"row q-gutter-sm"},Y=10,Ot=Ce({__name:"reviews",setup(t){Pe("用戶評價 - 護理服務平台","查看其他用戶對護理服務的評價與回饋");const $=Be(),x=Re(),v=Qe(),R=De(),i=V([]),m=V([]),C=V(!1),k=V(!1),D=V(1),y=V(null),c=V({caregiver_id:null,rating:0,comment:"",service_type:""}),z=["一般照護","專業護理","復健協助","夜間照護","失智症照護","長期照護"],P=u(()=>[{label:"全部看護師",value:null},...m.value.map(e=>({label:e.name,value:e.id}))]),h=u(()=>i.value.length===0?0:i.value.reduce((e,a)=>e+a.rating,0)/i.value.length),U=u(()=>Math.ceil(i.value.length/Y)),F=u(()=>{const e=(D.value-1)*Y,a=e+Y;return i.value.slice(e,a)}),J=async()=>{try{const e=await v.getCaregivers(1,100);m.value=Array.isArray(e)?e:e.data||[]}catch(e){console.error("載入看護師列表失敗:",e)}},S=async()=>{C.value=!0;try{if(y.value)i.value=await v.getReviewsByCaregiver(y.value);else{const e=[];for(const a of m.value.slice(0,5))try{const r=await v.getReviewsByCaregiver(a.id);e.push(...r)}catch(r){console.warn(`載入看護師 ${a.id} 的評價失敗:`,r)}i.value=e.sort((a,r)=>new Date(r.created_at).getTime()-new Date(a.created_at).getTime())}}catch(e){console.error("載入評價失敗:",e),x.notify({type:"negative",message:e.message||"載入評價失敗",timeout:3e3})}finally{C.value=!1}},Q=async()=>{if(!c.value.caregiver_id||!c.value.rating||!c.value.comment){x.notify({type:"warning",message:"請填寫完整的評價資訊",timeout:3e3});return}if(!R.currentUser){x.notify({type:"warning",message:"請先登入才能提交評價",timeout:3e3});return}k.value=!0;try{const e={caregiver_id:c.value.caregiver_id,user_id:R.currentUser.id,rating:c.value.rating,comment:c.value.comment,service_type:c.value.service_type},a=await v.createReview(e);i.value.unshift(a),x.notify({type:"positive",message:"評價提交成功！",timeout:3e3}),T()}catch(e){console.error("提交評價失敗:",e),x.notify({type:"negative",message:e.message||"提交評價失敗",timeout:3e3})}finally{k.value=!1}},T=()=>{c.value={caregiver_id:null,rating:0,comment:"",service_type:""}},W=e=>{if(!R.currentUser){x.notify({type:"warning",message:"請先登入才能按讚",timeout:2e3});return}e.liked=!e.liked,e.likes=(e.likes||0)+(e.liked?1:-1),x.notify({type:"positive",message:e.liked?"已按讚":"已取消按讚",timeout:1e3})},j=e=>i.value.filter(a=>Math.floor(a.rating)===e).length,H=e=>i.value.length===0?0:j(e)/i.value.length,B=e=>["","非常不滿意","不滿意","一般","滿意","非常滿意"][e]||"",A=e=>new Date(e).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit"}),Z=e=>{D.value=e,window.scrollTo({top:0,behavior:"smooth"})};ee(()=>$.query.caregiverId,e=>{e&&(y.value=parseInt(e))},{immediate:!0}),Ne(async()=>{await J(),await S()});const{$route:G}=$e(),o=ze().public.baseUrl||"";return ee([i,h],([e,a])=>{e.length>0&&Fe({script:[{type:"application/ld+json",children:JSON.stringify({"@context":"https://schema.org","@type":"Service",name:"護理服務平台",url:o+G.fullPath,aggregateRating:{"@type":"AggregateRating",ratingValue:a,reviewCount:e.length,bestRating:5,worstRating:1},review:e.slice(0,10).map(r=>({"@type":"Review",reviewRating:{"@type":"Rating",ratingValue:r.rating},author:{"@type":"Person",name:r.user_name||"匯名用戶"},reviewBody:r.comment,datePublished:r.created_at}))})}]})}),(e,a)=>{const r=Te,N=We,f=re,g=He,te=Ue,ue=Ze,O=Me,E=Le,de=Ge,ce=Ie,me=Xe,X=Ee,ae=Oe,ve=Ae,ge=je,_e=tt,pe=ie,ye=Ye,fe=et;return _(),M(fe,{class:"q-pa-md"},{default:d(()=>[s("div",at,[s("div",nt,[s("div",lt,[s("div",ot,[n(r,{name:"rate_review",size:"md",class:"q-mr-sm"}),a[7]||(a[7]=b(" 用戶評價 ",-1))]),s("div",st,[n(N,{modelValue:y.value,"onUpdate:modelValue":[a[0]||(a[0]=l=>y.value=l),S],options:P.value,label:"選擇看護師",outlined:"",dense:"",clearable:"","emit-value":"","map-options":"",style:{"min-width":"200px"}},null,8,["modelValue","options"]),n(f,{flat:"",icon:"refresh",onClick:S,loading:C.value},{default:d(()=>a[8]||(a[8]=[b(" 更新 ",-1)])),_:1,__:[8]},8,["loading"])])]),n(E,{flat:"",bordered:"",class:"q-mb-lg"},{default:d(()=>[n(O,null,{default:d(()=>[s("div",it,[s("div",rt,[s("div",ut,p(h.value.toFixed(1)),1),n(g,{"model-value":h.value,readonly:"",color:"orange",size:"2em",class:"q-mt-xs"},null,8,["model-value"]),s("div",dt," 平均評分 (基於 "+p(i.value.length)+" 則評價) ",1)]),n(te,{vertical:""}),s("div",ct,[a[9]||(a[9]=s("div",{class:"text-h6 q-mb-md"},"評價分佈",-1)),(_(),w(le,null,oe([5,4,3,2,1],l=>s("div",{key:l,class:"row items-center q-mb-xs"},[s("div",mt,p(l)+" 星",1),n(ue,{value:H(l),color:"orange",size:"md",class:"col q-mr-sm"},null,8,["value"]),s("div",vt,p(j(l)),1)])),64))])])]),_:1})]),_:1}),C.value?(_(),w("div",gt,[n(de,{size:"50px",color:"primary"}),a[10]||(a[10]=s("div",{class:"text-body2 q-mt-md"},"載入中...",-1))])):i.value.length>0?(_(),w("div",_t,[n(E,{flat:"",bordered:"",class:"q-mb-lg"},{default:d(()=>[n(O,null,{default:d(()=>[a[13]||(a[13]=s("div",{class:"text-h6 q-mb-md"},"所有評價",-1)),n(ge,null,{default:d(()=>[(_(!0),w(le,null,oe(F.value,l=>(_(),M(ve,{key:l.id,class:"q-pa-md"},{default:d(()=>[n(ae,null,{default:d(()=>[n(X,{class:"row items-center q-mb-sm"},{default:d(()=>[n(g,{"model-value":l.rating,readonly:"",color:"orange",size:"1em",class:"q-mr-sm"},null,8,["model-value"]),s("span",pt,p(A(l.created_at)),1),n(ce),l.verified?(_(),M(me,{key:0,size:"sm",color:"positive","text-color":"white",icon:"verified"},{default:d(()=>a[11]||(a[11]=[b(" 已驗證 ",-1)])),_:1,__:[11]})):I("",!0)]),_:2},1024),n(X,{class:"text-body1 q-mb-sm"},{default:d(()=>[b(p(l.comment),1)]),_:2},1024),n(X,{caption:"",class:"text-grey-6"},{default:d(()=>[b(" 由 "+p(l.user_name||"匯名用戶")+" 提供 ",1),l.service_type?(_(),w("span",yt," · "+p(l.service_type),1)):I("",!0)]),_:2},1024),l.reply?(_(),w("div",ft,[s("div",bt,[n(r,{name:"reply",size:"xs",class:"q-mr-xs"}),a[12]||(a[12]=b(" 看護師回覆： ",-1))]),s("div",xt,p(l.reply),1)])):I("",!0)]),_:2},1024),n(ae,{side:"",top:""},{default:d(()=>[s("div",ht,[n(f,{flat:"",dense:"",icon:"thumb_up",size:"sm",color:l.liked?"primary":"grey",onClick:Nt=>W(l)},{default:d(()=>[b(p(l.likes||0),1)]),_:2},1032,["color","onClick"])])]),_:2},1024),n(te,{spaced:"",inset:"item"})]),_:2},1024))),128))]),_:1}),U.value>1?(_(),w("div",qt,[n(_e,{modelValue:D.value,"onUpdate:modelValue":[a[1]||(a[1]=l=>D.value=l),Z],max:U.value,"direction-links":"","boundary-links":"","icon-first":"skip_previous","icon-last":"skip_next","icon-prev":"fast_rewind","icon-next":"fast_forward"},null,8,["modelValue","max"])])):I("",!0)]),_:1,__:[13]})]),_:1})])):(_(),w("div",kt,[n(r,{name:"rate_review",size:"80px",color:"grey-5"}),a[14]||(a[14]=s("div",{class:"text-h6 q-mt-md text-grey-7"},"尚無評價",-1)),s("div",St,p(y.value?"這位看護師還沒有收到評價":"請選擇看護師查看評價"),1)])),se(R).currentUser?(_(),M(E,{key:3,flat:"",bordered:""},{default:d(()=>[n(O,null,{default:d(()=>[s("div",wt,[n(r,{name:"edit",class:"q-mr-sm"}),a[15]||(a[15]=b(" 撰寫評價 ",-1))]),n(ye,{onSubmit:Ke(Q,["prevent"]),class:"q-gutter-md"},{default:d(()=>[s("div",Vt,[s("div",Ct,[n(N,{modelValue:c.value.caregiver_id,"onUpdate:modelValue":a[2]||(a[2]=l=>c.value.caregiver_id=l),options:P.value,label:"選擇看護師 *",outlined:"",dense:"","emit-value":"","map-options":"",rules:[l=>!!l||"請選擇看護師"]},null,8,["modelValue","options","rules"])]),s("div",Pt,[n(N,{modelValue:c.value.service_type,"onUpdate:modelValue":a[3]||(a[3]=l=>c.value.service_type=l),options:z,label:"服務類型",outlined:"",dense:""},null,8,["modelValue"])])]),s("div",Bt,[a[16]||(a[16]=s("div",{class:"text-subtitle2"},"評分 *",-1)),n(g,{modelValue:c.value.rating,"onUpdate:modelValue":a[4]||(a[4]=l=>c.value.rating=l),max:5,color:"orange",size:"2em"},null,8,["modelValue"]),s("div",Rt,p(B(c.value.rating)),1)]),n(pe,{modelValue:c.value.comment,"onUpdate:modelValue":a[5]||(a[5]=l=>c.value.comment=l),label:"評價內容 *",type:"textarea",outlined:"",rows:"4",placeholder:"請分享您的服務體驗...",rules:[l=>!!l||"請填寫評價內容"]},null,8,["modelValue","rules"]),s("div",Dt,[n(f,{type:"submit",color:"primary",loading:k.value,disable:!c.value.caregiver_id||!c.value.rating||!c.value.comment},{default:d(()=>[b(p(k.value?"提交中...":"提交評價"),1)]),_:1},8,["loading","disable"]),n(f,{flat:"",color:"grey",onClick:T,disable:k.value},{default:d(()=>a[17]||(a[17]=[b(" 清除 ",-1)])),_:1,__:[17]},8,["disable"])])]),_:1})]),_:1})]),_:1})):(_(),M(E,{key:4,flat:"",bordered:""},{default:d(()=>[n(O,{class:"text-center"},{default:d(()=>[n(r,{name:"login",size:"50px",color:"grey-5"}),a[19]||(a[19]=s("div",{class:"text-h6 q-mt-md text-grey-7"},"登入後可撰寫評價",-1)),a[20]||(a[20]=s("div",{class:"text-body2 text-grey-6 q-mb-md"}," 請先登入您的帳戶以撰寫和提交評價 ",-1)),n(f,{color:"primary",onClick:a[6]||(a[6]=l=>("navigateTo"in e?e.navigateTo:se(Je))("/auth/login"))},{default:d(()=>a[18]||(a[18]=[b(" 立即登入 ",-1)])),_:1,__:[18]})]),_:1,__:[19,20]})]),_:1}))])])]),_:1})}}});export{Ot as default};
