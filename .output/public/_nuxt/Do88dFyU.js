import{u as Y}from"./Bs_-0E3x.js";import{v as j,y as F,z as T,A as f,c as M,o as c,b as B,w as n,a as t,e,l as m,j as H,am as G,J as b,ae as O,D as X,f as I,t as _,d as J,u as Z,R as L,a1 as ee,ai as te,q as oe,p as se,g as ae,K as ne,L as le,h as ie,i as re,k as de,m as ue}from"./DLx3-ifv.js";import{_ as ce}from"./BCeXGjXm.js";import{_ as _e}from"./C5go2q6Y.js";import{_ as me}from"./DlcMHTQ2.js";import{_ as pe}from"./BFiq8LBz.js";import{_ as ve}from"./CSiiy5fn.js";const ge={class:"text-h6 q-mb-md"},ye={class:"row q-gutter-md"},fe={class:"col-12 col-sm-6"},be={class:"col-12 col-sm-6"},xe={key:0,class:"q-pa-md bg-grey-1 rounded-borders"},qe={class:"row q-gutter-md"},he={class:"col-12"},Ve={class:"col-6"},ke={class:"col-6"},Se={class:"col-12"},$e={key:1,class:"q-pa-md bg-blue-1 rounded-borders"},we={key:2,class:"q-pa-md bg-green-1 rounded-borders"},Me={class:"row q-gutter-sm"},Pe={class:"col"},Ue={class:"col-auto"},De={class:"col-auto"},Ne=j({__name:"PaymentForm",emits:["payment-success"],setup(R,{emit:h}){const x=F(),k=Y();T();const r=f(""),u=f(null),d=f("credit_card"),p=f(!1),i=f({number:"",expiryMonth:"",expiryYear:"",cvv:""}),P=[{label:"信用卡",value:"credit_card"},{label:"銀行轉帳",value:"bank_transfer"},{label:"現金付款",value:"cash"}],U=h,D=async()=>{if(!r.value||!u.value){x.notify({type:"negative",message:"請填寫完整的付款資訊",timeout:3e3});return}if(d.value==="credit_card"&&(!i.value.number||!i.value.expiryMonth||!i.value.expiryYear||!i.value.cvv)){x.notify({type:"negative",message:"請填寫完整的信用卡資訊",timeout:3e3});return}p.value=!0;try{const g={bookingId:r.value,amount:u.value,method:d.value,...d.value==="credit_card"&&{cardDetails:i.value}},o=await k.processPayment(g);x.notify({type:"positive",message:"付款成功！",timeout:3e3}),S(),U("payment-success",o)}catch(g){console.error("付款失敗:",g),x.notify({type:"negative",message:g.message||"付款失敗，請稍後再試",timeout:5e3})}finally{p.value=!1}},S=()=>{r.value="",u.value=null,d.value="credit_card",i.value={number:"",expiryMonth:"",expiryYear:"",cvv:""}},N=()=>{r.value="booking-test-"+Date.now(),u.value=1500,d.value="credit_card",i.value={number:"4111111111111111",expiryMonth:"12",expiryYear:"2025",cvv:"123"}};return(g,o)=>{const A=H,a=X,s=_e,q=I,C=ce,z=J,V=B;return c(),M(V,{flat:"",bordered:""},{default:n(()=>[t(z,null,{default:n(()=>[e("div",ge,[t(A,{name:"payment",class:"q-mr-sm"}),o[7]||(o[7]=m(" 新增付款 ",-1))]),t(C,{onSubmit:G(D,["prevent"]),class:"q-gutter-md"},{default:n(()=>[e("div",ye,[e("div",fe,[t(a,{modelValue:r.value,"onUpdate:modelValue":o[0]||(o[0]=l=>r.value=l),label:"預約編號 *",outlined:"",dense:"",placeholder:"輸入預約編號"},null,8,["modelValue"])]),e("div",be,[t(a,{modelValue:u.value,"onUpdate:modelValue":o[1]||(o[1]=l=>u.value=l),modelModifiers:{number:!0},label:"付款金額 *",type:"number",outlined:"",dense:"",min:"1",suffix:"元",placeholder:"0"},null,8,["modelValue"])])]),t(s,{modelValue:d.value,"onUpdate:modelValue":o[2]||(o[2]=l=>d.value=l),options:P,label:"付款方式 *",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue"]),d.value==="credit_card"?(c(),b("div",xe,[o[8]||(o[8]=e("div",{class:"text-subtitle2 q-mb-md"},"信用卡資訊",-1)),e("div",qe,[e("div",he,[t(a,{modelValue:i.value.number,"onUpdate:modelValue":o[3]||(o[3]=l=>i.value.number=l),label:"信用卡號碼 *",outlined:"",dense:"",mask:"#### #### #### ####",placeholder:"1234 5678 9012 3456"},null,8,["modelValue"])]),e("div",Ve,[t(s,{modelValue:i.value.expiryMonth,"onUpdate:modelValue":o[4]||(o[4]=l=>i.value.expiryMonth=l),options:Array.from({length:12},(l,y)=>({label:String(y+1).padStart(2,"0"),value:String(y+1).padStart(2,"0")})),label:"月份 *",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),e("div",ke,[t(s,{modelValue:i.value.expiryYear,"onUpdate:modelValue":o[5]||(o[5]=l=>i.value.expiryYear=l),options:Array.from({length:10},(l,y)=>({label:String(2024+y),value:String(2024+y)})),label:"年份 *",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),e("div",Se,[t(a,{modelValue:i.value.cvv,"onUpdate:modelValue":o[6]||(o[6]=l=>i.value.cvv=l),label:"CVV *",outlined:"",dense:"",mask:"###",placeholder:"123"},null,8,["modelValue"])])])])):d.value==="bank_transfer"?(c(),b("div",$e,o[9]||(o[9]=[e("div",{class:"text-subtitle2 q-mb-sm"},"銀行轉帳資訊",-1),e("div",{class:"text-body2"},[e("div",null,"銀行：台灣銀行"),e("div",null,"戶名：護理服務平台有限公司"),e("div",null,"帳號：123-456-789012"),e("div",{class:"text-caption text-grey-6 q-mt-sm"},"請於轉帳完成後提交此表單")],-1)]))):d.value==="cash"?(c(),b("div",we,o[10]||(o[10]=[e("div",{class:"text-subtitle2 q-mb-sm"},"現金付款",-1),e("div",{class:"text-body2"}," 請於服務時直接向看護師付款，並索取收據。 ",-1)]))):O("",!0),e("div",Me,[e("div",Pe,[t(q,{flat:"",color:"grey",onClick:S,disable:p.value},{default:n(()=>o[11]||(o[11]=[m(" 清除 ",-1)])),_:1,__:[11]},8,["disable"])]),e("div",Ue,[t(q,{flat:"",color:"orange",onClick:N,disable:p.value,size:"sm"},{default:n(()=>o[12]||(o[12]=[m(" 填入測試資料 ",-1)])),_:1,__:[12]},8,["disable"])]),e("div",De,[t(q,{type:"submit",color:"primary",loading:p.value,icon:"payment"},{default:n(()=>[m(_(p.value?"處理中...":"確認付款"),1)]),_:1},8,["loading"])])])]),_:1})]),_:1})]),_:1})}}}),Ae=Object.assign(Ne,{__name:"PaymentForm"}),Ce={class:"row justify-center"},ze={class:"col-12 col-lg-10"},Le={class:"row items-center q-mb-lg"},Ye={class:"text-h5 text-primary"},je={class:"row items-center justify-between q-mb-md"},Fe={key:0,class:"text-center q-pa-lg"},Te={key:1,class:"text-center q-pa-lg"},Be={class:"text-right"},He={class:"text-h6 text-primary"},Oe={class:"text-caption text-grey-6"},Ie={key:3,class:"q-mt-md"},Je={class:"row q-gutter-md"},Re={class:"col"},We={class:"text-h6 text-blue-8"},Ee={class:"col"},Ke={class:"text-h6 text-green-8"},Qe={class:"col"},Ge={class:"text-h6 text-orange-8"},nt=j({__name:"payments",setup(R){Z("支付管理 - 護理服務平台","查看您的支付紀錄和管理新支付");const h=F(),x=Y(),k=T(),r=f([]),u=f(!1),d=L(()=>r.value.reduce((a,s)=>a+s.amount,0)),p=L(()=>r.value.filter(a=>a.status==="completed").length),i=async()=>{if(!k.currentUser){h.notify({type:"warning",message:"請先登入才能查看支付紀錄",timeout:3e3});return}u.value=!0;try{const a=await x.getPaymentHistory(k.currentUser.id);r.value=Array.isArray(a)?a:[]}catch(a){console.error("載入支付紀錄失敗:",a),h.notify({type:"negative",message:a.message||"載入支付紀錄失敗",timeout:3e3})}finally{u.value=!1}},P=a=>{r.value.unshift(a),h.notify({type:"positive",message:"支付成功！新的支付紀錄已添加",timeout:3e3})},U=a=>new Date(a).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),D=a=>({credit_card:"信用卡",bank_transfer:"銀行轉帳",cash:"現金付款"})[a]||a,S=a=>({completed:"已完成",pending:"處理中",failed:"失敗",cancelled:"已取消"})[a]||a,N=a=>({completed:"positive",pending:"warning",failed:"negative",cancelled:"grey"})[a]||"grey";ee(()=>{i()});const{$route:g}=te(),A=oe().public.baseUrl||"";return se({script:[{type:"application/ld+json",children:JSON.stringify({"@context":"https://schema.org","@type":"WebPage",name:"支付管理 - 護理服務平台",url:A+g.fullPath,description:"查看您的支付紀錄和管理新支付",provider:{"@type":"Organization",name:"護理服務平台"}})}]}),(a,s)=>{const q=H,C=I,z=me,V=de,l=re,y=pe,W=ie,E=ae,K=ue,$=J,w=B,Q=ve;return c(),M(Q,{class:"q-pa-md"},{default:n(()=>[e("div",Ce,[e("div",ze,[e("div",Le,[e("div",Ye,[t(q,{name:"account_balance_wallet",size:"md",class:"q-mr-sm"}),s[0]||(s[0]=m(" 支付管理 ",-1))])]),t(w,{flat:"",bordered:"",class:"q-mb-lg"},{default:n(()=>[t($,null,{default:n(()=>[e("div",je,[s[2]||(s[2]=e("div",{class:"text-h6"},"支付紀錄",-1)),t(C,{flat:"",icon:"refresh",onClick:i,loading:u.value},{default:n(()=>s[1]||(s[1]=[m(" 更新 ",-1)])),_:1,__:[1]},8,["loading"])]),u.value?(c(),b("div",Fe,[t(z,{size:"50px",color:"primary"}),s[3]||(s[3]=e("div",{class:"text-body2 q-mt-md"},"載入中...",-1))])):r.value.length===0?(c(),b("div",Te,[t(q,{name:"payment",size:"80px",color:"grey-5"}),s[4]||(s[4]=e("div",{class:"text-h6 q-mt-md text-grey-7"},"尚無支付紀錄",-1)),s[5]||(s[5]=e("div",{class:"text-body2 text-grey-6"}," 您的支付紀錄將在此顯示 ",-1))])):(c(),M(E,{key:2,bordered:"",class:"rounded-borders"},{default:n(()=>[(c(!0),b(ne,null,le(r.value,v=>(c(),M(W,{key:v.id,class:"q-pa-md"},{default:n(()=>[t(l,null,{default:n(()=>[t(V,{class:"text-weight-medium"},{default:n(()=>[m(" 交易編號: "+_(v.transaction_id),1)]),_:2},1024),t(V,{caption:""},{default:n(()=>[m(" 預約編號: "+_(v.booking_id),1)]),_:2},1024),t(V,{caption:"",class:"text-grey-6"},{default:n(()=>[m(_(U(v.created_at)),1)]),_:2},1024)]),_:2},1024),t(l,{side:""},{default:n(()=>[e("div",Be,[e("div",He," NT$ "+_(v.amount.toLocaleString()),1),e("div",Oe,_(D(v.method)),1)])]),_:2},1024),t(l,{side:""},{default:n(()=>[t(y,{color:N(v.status),"text-color":"white",size:"sm"},{default:n(()=>[m(_(S(v.status)),1)]),_:2},1032,["color"])]),_:2},1024)]),_:2},1024))),128))]),_:1})),r.value.length>0?(c(),b("div",Ie,[t(K,{class:"q-mb-md"}),e("div",Je,[e("div",Re,[t(w,{flat:"",class:"bg-blue-1"},{default:n(()=>[t($,{class:"text-center"},{default:n(()=>[e("div",We," NT$ "+_(d.value.toLocaleString()),1),s[6]||(s[6]=e("div",{class:"text-caption text-blue-6"},"總支付金額",-1))]),_:1,__:[6]})]),_:1})]),e("div",Ee,[t(w,{flat:"",class:"bg-green-1"},{default:n(()=>[t($,{class:"text-center"},{default:n(()=>[e("div",Ke,_(p.value),1),s[7]||(s[7]=e("div",{class:"text-caption text-green-6"},"成功交易",-1))]),_:1,__:[7]})]),_:1})]),e("div",Qe,[t(w,{flat:"",class:"bg-orange-1"},{default:n(()=>[t($,{class:"text-center"},{default:n(()=>[e("div",Ge,_(r.value.length),1),s[8]||(s[8]=e("div",{class:"text-caption text-orange-6"},"總交易次數",-1))]),_:1,__:[8]})]),_:1})])])])):O("",!0)]),_:1})]),_:1}),t(Ae,{onPaymentSuccess:P})])])]),_:1})}}});export{nt as default};
