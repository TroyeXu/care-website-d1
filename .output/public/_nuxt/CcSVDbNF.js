import{C as j}from"./C-s1-Qrp.js";import{v as F,u as I,z as V,A as v,a1 as q,R as h,J as o,o as a,C as r,e as s,t as i,al as l,K as b,L as T,c as J,ap as $,ae as K,_ as P}from"./DLx3-ifv.js";import{u as W}from"./Bs_-0E3x.js";const G={class:"dashboard"},H={key:0,class:"dashboard-content"},O={class:"welcome-section"},Q={class:"user-info"},X=["src","alt"],Y={class:"user-details"},Z={class:"user-role"},x={class:"user-stats"},ss={class:"stat-item"},ts={class:"stat-number"},es={class:"stat-item"},ns={class:"stat-number"},as={class:"stat-item"},os={class:"stat-number"},is={class:"quick-actions"},rs={class:"action-grid"},ls={class:"recommendations-section"},ds={key:0,class:"caregivers-grid"},cs={key:1,class:"empty-state"},us={class:"upcoming-section"},vs={key:0,class:"bookings-list"},gs={class:"booking-info"},ps={class:"booking-caregiver"},ms={class:"booking-details"},ks={class:"booking-date"},_s={class:"booking-time"},hs={class:"booking-type"},ys={class:"booking-actions"},bs=["onClick"],Ts=["onClick"],fs={key:1,class:"empty-state"},Cs={class:"history-section"},ws={key:0,class:"history-list"},Bs={class:"history-info"},Ds={class:"history-caregiver"},$s={class:"history-date"},Ss={class:"history-cost"},Us={key:1,class:"empty-state"},As={key:1,class:"login-prompt"},Rs={class:"login-card"},Ls={class:"login-actions"},Ns=F({__name:"dashboard",setup(zs){I("個人儀表板 - 護理服務平台","快速查看推薦看護及即將到來的排程");const d=V(),g=W(),S=v(null),p=v([]),m=v([]),k=v([]),f=v([]);q(async()=>{await C()});const C=async()=>{try{if(d.currentUser){S.value=await g.getDashboardStats(d.currentUser.id);const e=await g.getFeaturedCaregivers();p.value=e.data||e,f.value=p.value;const u=await g.getBookingsByUser(d.currentUser.id)||[],n=new Date;m.value=u.filter(c=>new Date(c.start_date)>=n&&["confirmed","pending"].includes(c.status)).sort((c,_)=>new Date(c.start_date).getTime()-new Date(_.start_date).getTime()).slice(0,3),k.value=u.sort((c,_)=>new Date(_.created_at).getTime()-new Date(c.created_at).getTime())}}catch(e){console.error("載入儀表板資料失敗:",e)}},U=h(()=>{switch(d.currentUser?.role){case"patient":return"照護需求者";case"caregiver":return"看護人員";case"admin":return"管理員";default:return"用戶"}}),y=h(()=>[...m.value,...k.value]),A=h(()=>y.value.filter(e=>e.status==="completed")),R=h(()=>y.value.filter(e=>e.status==="pending")),L=e=>{const t=e.target;t.src="/images/default-avatar.jpg"},w=e=>f.value.find(u=>u.id===e)?.name||"未知看護師",B=e=>new Date(e).toLocaleDateString("zh-TW",{year:"numeric",month:"short",day:"numeric"}),N=e=>e==="hourly"?"按時計費":"包班制",D=e=>({pending:"待確認",confirmed:"已確認",in_progress:"進行中",completed:"已完成",cancelled:"已取消"})[e]||e,z=e=>{l(`/caregivers/${e.id}?action=book`)},E=e=>{l(`/bookings/${e.id}`)},M=async e=>{if(confirm("確定要取消這個預約嗎？"))try{await g.cancelBooking(e.id),alert("預約已取消"),await C()}catch{alert("取消預約時發生錯誤")}};return(e,t)=>{const u=j;return a(),o("div",G,[r(d).isAuthenticated?(a(),o("div",H,[s("div",O,[s("div",Q,[s("img",{src:r(d).currentUser?.avatar||"/images/default-avatar.jpg",alt:r(d).currentUser?.name,class:"user-avatar",onError:L},null,40,X),s("div",Y,[s("h1",null,"歡迎回來，"+i(r(d).currentUser?.name),1),s("p",Z,i(U.value)+" | "+i(r(d).currentUser?.email),1),s("div",x,[s("div",ss,[s("span",ts,i(y.value.length),1),t[9]||(t[9]=s("span",{class:"stat-label"},"總預約數",-1))]),s("div",es,[s("span",ns,i(A.value.length),1),t[10]||(t[10]=s("span",{class:"stat-label"},"已完成",-1))]),s("div",as,[s("span",os,i(R.value.length),1),t[11]||(t[11]=s("span",{class:"stat-label"},"待確認",-1))])])])])]),s("div",is,[t[16]||(t[16]=s("h2",null,"快速操作",-1)),s("div",rs,[s("button",{class:"action-card",onClick:t[0]||(t[0]=n=>("navigateTo"in e?e.navigateTo:r(l))("/caregivers/search"))},t[12]||(t[12]=[s("div",{class:"action-icon"},"🔍",-1),s("div",{class:"action-text"},[s("h3",null,"搜尋看護"),s("p",null,"找到最適合的看護師")],-1)])),s("button",{class:"action-card",onClick:t[1]||(t[1]=n=>("navigateTo"in e?e.navigateTo:r(l))("/booking/calculator"))},t[13]||(t[13]=[s("div",{class:"action-icon"},"💰",-1),s("div",{class:"action-text"},[s("h3",null,"費用計算"),s("p",null,"估算照護服務費用")],-1)])),s("button",{class:"action-card",onClick:t[2]||(t[2]=n=>("navigateTo"in e?e.navigateTo:r(l))("/booking/match"))},t[14]||(t[14]=[s("div",{class:"action-icon"},"🎯",-1),s("div",{class:"action-text"},[s("h3",null,"智能媒合"),s("p",null,"AI 推薦最佳看護")],-1)])),s("button",{class:"action-card",onClick:t[3]||(t[3]=n=>("navigateTo"in e?e.navigateTo:r(l))("/booking/schedule"))},t[15]||(t[15]=[s("div",{class:"action-icon"},"📅",-1),s("div",{class:"action-text"},[s("h3",null,"排程管理"),s("p",null,"查看預約時程")],-1)]))])]),s("div",ls,[t[18]||(t[18]=s("h2",null,"為您推薦",-1)),p.value.length>0?(a(),o("div",ds,[(a(!0),o(b,null,T(p.value,n=>(a(),J(u,{key:n.id,caregiver:n,onBook:z},null,8,["caregiver"]))),128))])):(a(),o("div",cs,[t[17]||(t[17]=s("p",null,"暫無推薦看護師，請先完善您的個人資料和偏好設定",-1)),s("button",{class:"btn-primary",onClick:t[4]||(t[4]=n=>("navigateTo"in e?e.navigateTo:r(l))("/profile"))}," 完善資料 ")]))]),s("div",us,[t[20]||(t[20]=s("h2",null,"即將到來的預約",-1)),m.value.length>0?(a(),o("div",vs,[(a(!0),o(b,null,T(m.value,n=>(a(),o("div",{key:n.id,class:"booking-card"},[s("div",gs,[s("div",ps,[s("strong",null,i(w(n.caregiver_id)),1)]),s("div",ms,[s("span",ks,i(B(n.start_date)),1),s("span",_s,i(n.start_time),1),s("span",hs,i(N(n.service_type)),1)]),s("div",{class:$(["booking-status",`status-${n.status}`])},i(D(n.status)),3)]),s("div",ys,[s("button",{class:"btn-secondary btn-sm",onClick:c=>E(n)}," 查看詳情 ",8,bs),n.status==="pending"?(a(),o("button",{key:0,class:"btn-danger btn-sm",onClick:c=>M(n)}," 取消預約 ",8,Ts)):K("",!0)])]))),128))])):(a(),o("div",fs,[t[19]||(t[19]=s("p",null,"目前沒有即將到來的預約",-1)),s("button",{class:"btn-primary",onClick:t[5]||(t[5]=n=>("navigateTo"in e?e.navigateTo:r(l))("/caregivers/search"))}," 立即預約 ")]))]),s("div",Cs,[t[22]||(t[22]=s("h2",null,"服務歷史",-1)),k.value.length>0?(a(),o("div",ws,[(a(!0),o(b,null,T(k.value.slice(0,5),n=>(a(),o("div",{key:n.id,class:"history-item"},[s("div",Bs,[s("span",Ds,i(w(n.caregiver_id)),1),s("span",$s,i(B(n.start_date)),1),s("span",{class:$(["history-status",`status-${n.status}`])},i(D(n.status)),3)]),s("div",Ss," NT$ "+i(n.total_cost.toLocaleString()),1)]))),128)),s("button",{class:"btn-link",onClick:t[6]||(t[6]=n=>("navigateTo"in e?e.navigateTo:r(l))("/bookings"))}," 查看完整歷史記錄 ")])):(a(),o("div",Us,t[21]||(t[21]=[s("p",null,"尚無服務歷史記錄",-1)])))])])):(a(),o("div",As,[s("div",Rs,[t[23]||(t[23]=s("h2",null,"請先登入",-1)),t[24]||(t[24]=s("p",null,"登入後即可查看個人儀表板、預約記錄和推薦服務",-1)),s("div",Ls,[s("button",{class:"btn-primary",onClick:t[7]||(t[7]=n=>("navigateTo"in e?e.navigateTo:r(l))("/auth/login"))}," 立即登入 "),s("button",{class:"btn-secondary",onClick:t[8]||(t[8]=n=>("navigateTo"in e?e.navigateTo:r(l))("/auth/register"))}," 註冊帳號 ")])])]))])}}}),Fs=P(Ns,[["__scopeId","data-v-bd446c8a"]]);export{Fs as default};
