import{aq as e,n as l,ar as t,as as o,at as n,au as a,I as i,s as u,av as r,w as s,J as c,x as d,aw as p,B as v,ax as f,L as m,ay as S,az as g,aA as h,aB as y,aC as V,aD as w,r as b,aE as C,ai as x,a0 as I,ac as k,aF as O,aG as z,aH as T,aI as M,aJ as P,aK as A,aL as F,b as E,aM as q,aN as B,l as D,h as H,i as R,g as L,G as _}from"../build/server.mjs";import{_ as K}from"./QChip.mjs";import{v as N,a as $,u as j,b as U,c as W,p as X,d as Q,r as Y,e as G,s as J}from"./position-engine.mjs";import{n as Z,e as ee,az as le,aG as te,aF as oe,be as ne,k as ae,l as ie,aC as ue,o as re,aK as se,bg as ce}from"../nitro/nitro.mjs";const de=1e3,pe=["start","center","end","start-force","center-force","end-force"],ve=Array.prototype.filter;function sumFn(e,l){return e+l}function getScrollDetails(e,l,t,o,n,a,i,u){const r=e===window?document.scrollingElement||document.documentElement:e,s=!0===n?"offsetWidth":"offsetHeight",c={scrollStart:0,scrollViewSize:-i-u,scrollMaxSize:0,offsetStart:-i,offsetEnd:-u};if(!0===n?(e===window?(c.scrollStart=window.pageXOffset||window.scrollX||document.body.scrollLeft||0,c.scrollViewSize+=document.documentElement.clientWidth):(c.scrollStart=r.scrollLeft,c.scrollViewSize+=r.clientWidth),c.scrollMaxSize=r.scrollWidth,!0===a&&(c.scrollStart=0-c.scrollStart)):(e===window?(c.scrollStart=window.pageYOffset||window.scrollY||document.body.scrollTop||0,c.scrollViewSize+=document.documentElement.clientHeight):(c.scrollStart=r.scrollTop,c.scrollViewSize+=r.clientHeight),c.scrollMaxSize=r.scrollHeight),null!==t)for(let e=t.previousElementSibling;null!==e;e=e.previousElementSibling)!1===e.classList.contains("q-virtual-scroll--skip")&&(c.offsetStart+=e[s]);if(null!==o)for(let e=o.nextElementSibling;null!==e;e=e.nextElementSibling)!1===e.classList.contains("q-virtual-scroll--skip")&&(c.offsetEnd+=e[s]);if(l!==e){const t=r.getBoundingClientRect(),o=l.getBoundingClientRect();!0===n?(c.offsetStart+=o.left-t.left,c.offsetEnd-=o.width):(c.offsetStart+=o.top-t.top,c.offsetEnd-=o.height),e!==window&&(c.offsetStart+=c.scrollStart),c.offsetEnd+=c.scrollMaxSize-c.offsetStart}return c}function setScroll(e,l,t,o){"end"===l&&(l=(e===window?document.body:e)[!0===t?"scrollWidth":"scrollHeight"]),e===window?!0===t?(!0===o&&(l=0-l),window.scrollTo(l,window.pageYOffset||window.scrollY||document.body.scrollTop||0)):window.scrollTo(window.pageXOffset||window.scrollX||document.body.scrollLeft||0,l):!0===t?(!0===o&&(l=0-l),e.scrollLeft=l):e.scrollTop=l}function sumSize(e,l,t,o){if(t>=o)return 0;const n=l.length,a=Math.floor(t/de),i=Math.floor((o-1)/de)+1;let u=e.slice(a,i).reduce(sumFn,0);return t%de!==0&&(u-=l.slice(a*de,t).reduce(sumFn,0)),o%de!==0&&o!==n&&(u-=l.slice(o,i*de).reduce(sumFn,0)),u}const fe={virtualScrollSliceSize:{type:[Number,String],default:10},virtualScrollSliceRatioBefore:{type:[Number,String],default:1},virtualScrollSliceRatioAfter:{type:[Number,String],default:1},virtualScrollItemSize:{type:[Number,String],default:24},virtualScrollStickySizeStart:{type:[Number,String],default:0},virtualScrollStickySizeEnd:{type:[Number,String],default:0},tableColspan:[Number,String]},me=Object.keys(fe),Se={virtualScrollHorizontal:Boolean,onVirtualScroll:Function,...fe};function useVirtualScroll({virtualScrollLength:l,getVirtualScrollTarget:t,getVirtualScrollEl:o,virtualScrollItemSizeComputed:n}){const a=Z(),{props:i,emit:u,proxy:r}=a,{$q:s}=r;let c,d,p,v,f=[];const m=ee(0),S=ee(0),g=ee({}),h=ee(null),y=ee(null),V=ee(null),w=ee({from:0,to:0}),b=le((()=>void 0!==i.tableColspan?i.tableColspan:100));void 0===n&&(n=le((()=>i.virtualScrollItemSize)));const C=le((()=>n.value+";"+i.virtualScrollHorizontal)),x=le((()=>C.value+";"+i.virtualScrollSliceRatioBefore+";"+i.virtualScrollSliceRatioAfter));function reset(){localResetVirtualScroll(d,!0)}function refresh(e){localResetVirtualScroll(void 0===e?d:e)}function scrollTo(e,n){const a=t();if(null==a||8===a.nodeType)return;const u=getScrollDetails(a,o(),h.value,y.value,i.virtualScrollHorizontal,s.lang.rtl,i.virtualScrollStickySizeStart,i.virtualScrollStickySizeEnd);p!==u.scrollViewSize&&setVirtualScrollSize(u.scrollViewSize),setVirtualScrollSliceRange(a,u,Math.min(l.value-1,Math.max(0,parseInt(e,10)||0)),0,-1!==pe.indexOf(n)?n:-1!==d&&e>d?"end":"start")}function setVirtualScrollSliceRange(e,t,o,n,a){const u="string"==typeof a&&-1!==a.indexOf("-force"),r=!0===u?a.replace("-force",""):a,d=void 0!==r?r:"start";let p=Math.max(0,o-g.value[d]),h=p+g.value.total;h>l.value&&(h=l.value,p=Math.max(0,h-g.value.total)),c=t.scrollStart;const y=p!==w.value.from||h!==w.value.to;if(!1===y&&void 0===r)return void emitScroll(o);const{activeElement:b}=document,C=V.value;!0===y&&null!==C&&C!==b&&!0===C.contains(b)&&(C.addEventListener("focusout",onBlurRefocusFn),setTimeout((()=>{C?.removeEventListener("focusout",onBlurRefocusFn)})));const x=void 0!==r?v.slice(p,o).reduce(sumFn,0):0;if(!0===y){const e=h>=w.value.from&&p<=w.value.to?w.value.to:h;w.value={from:p,to:e},m.value=sumSize(f,v,0,p),S.value=sumSize(f,v,h,l.value),requestAnimationFrame((()=>{w.value.to!==h&&c===t.scrollStart&&(w.value={from:w.value.from,to:h},S.value=sumSize(f,v,h,l.value))}))}requestAnimationFrame((()=>{if(c!==t.scrollStart)return;!0===y&&updateVirtualScrollSizes(p);const l=v.slice(p,o).reduce(sumFn,0),a=l+t.offsetStart+m.value,d=a+v[o];let f=a+n;if(void 0!==r){const e=l-x,n=t.scrollStart+e;f=!0!==u&&n<a&&d<n+t.scrollViewSize?n:"end"===r?d-t.scrollViewSize:a-("start"===r?0:Math.round((t.scrollViewSize-v[o])/2))}c=f,setScroll(e,f,i.virtualScrollHorizontal,s.lang.rtl),emitScroll(o)}))}function updateVirtualScrollSizes(e){const l=V.value;if(l){const t=ve.call(l.children,(e=>e.classList&&!1===e.classList.contains("q-virtual-scroll--skip"))),o=t.length,n=!0===i.virtualScrollHorizontal?e=>e.getBoundingClientRect().width:e=>e.offsetHeight;let a,u,r=e;for(let e=0;e<o;){for(a=n(t[e]),e++;e<o&&!0===t[e].classList.contains("q-virtual-scroll--with-prev");)a+=n(t[e]),e++;u=a-v[r],0!==u&&(v[r]+=u,f[Math.floor(r/de)]+=u),r++}}}function onBlurRefocusFn(){V.value?.focus()}function localResetVirtualScroll(e,t){const o=1*n.value;!0!==t&&!1!==Array.isArray(v)||(v=[]);const a=v.length;v.length=l.value;for(let e=l.value-1;e>=a;e--)v[e]=o;const i=Math.floor((l.value-1)/de);f=[];for(let e=0;e<=i;e++){let t=0;const o=Math.min((e+1)*de,l.value);for(let l=e*de;l<o;l++)t+=v[l];f.push(t)}d=-1,c=void 0,m.value=sumSize(f,v,0,w.value.from),S.value=sumSize(f,v,w.value.to,l.value),e>=0?(updateVirtualScrollSizes(w.value.from),oe((()=>{scrollTo(e)}))):I()}function setVirtualScrollSize(e){p=e;const l=parseFloat(i.virtualScrollSliceRatioBefore)||0,t=1+l+(parseFloat(i.virtualScrollSliceRatioAfter)||0),o=void 0===e||e<=0?1:Math.ceil(e/n.value),a=Math.max(1,o,Math.ceil((i.virtualScrollSliceSize>0?i.virtualScrollSliceSize:10)/t));g.value={total:Math.ceil(a*t),start:Math.ceil(a*l),center:Math.ceil(a*(.5+l)),end:Math.ceil(a*(1+l)),view:o}}function emitScroll(e){d!==e&&(void 0!==i.onVirtualScroll&&u("virtualScroll",{index:e,from:w.value.from,to:w.value.to-1,direction:e<d?"decrease":"increase",ref:r}),d=e)}te(x,(()=>{setVirtualScrollSize()})),te(C,reset),setVirtualScrollSize();const I=e((function(){const e=t();if(null==e||8===e.nodeType)return;const n=getScrollDetails(e,o(),h.value,y.value,i.virtualScrollHorizontal,s.lang.rtl,i.virtualScrollStickySizeStart,i.virtualScrollStickySizeEnd),a=l.value-1,u=n.scrollMaxSize-n.offsetStart-n.offsetEnd-S.value;if(c===n.scrollStart)return;if(n.scrollMaxSize<=0)return void setVirtualScrollSliceRange(e,n,0,0);p!==n.scrollViewSize&&setVirtualScrollSize(n.scrollViewSize),updateVirtualScrollSizes(w.value.from);const r=Math.floor(n.scrollMaxSize-Math.max(n.scrollViewSize,n.offsetEnd)-Math.min(v[a],n.scrollViewSize/2));if(r>0&&Math.ceil(n.scrollStart)>=r)return void setVirtualScrollSliceRange(e,n,a,n.scrollMaxSize-n.offsetEnd-f.reduce(sumFn,0));let d=0,g=n.scrollStart-n.offsetStart,V=g;if(g<=u&&g+n.scrollViewSize>=m.value)g-=m.value,d=w.value.from,V=g;else for(let e=0;g>=f[e]&&d<a;e++)g-=f[e],d+=de;for(;g>0&&d<a;)g-=v[d],g>-n.scrollViewSize?(d++,V=g):V=v[d]+g;setVirtualScrollSliceRange(e,n,d,V)}),!0===s.platform.is.ios?120:35);ne((()=>{setVirtualScrollSize()}));let k=!1;return ae((()=>{k=!0})),ie((()=>{if(!0!==k)return;const e=t();void 0!==c&&null!=e&&8!==e.nodeType?setScroll(e,c,i.virtualScrollHorizontal,s.lang.rtl):scrollTo(d)})),Object.assign(r,{scrollTo:scrollTo,reset:reset,refresh:refresh}),{virtualScrollSliceRange:w,virtualScrollSliceSizeComputed:g,setVirtualScrollSize:setVirtualScrollSize,onVirtualScrollEvt:I,localResetVirtualScroll:localResetVirtualScroll,padVirtualScroll:function(e,l){const t=!0===i.virtualScrollHorizontal?"width":"height",o={["--q-virtual-scroll-item-"+t]:n.value+"px"};return["tbody"===e?ue(e,{class:"q-virtual-scroll__padding",key:"before",ref:h},[ue("tr",[ue("td",{style:{[t]:`${m.value}px`,...o},colspan:b.value})])]):ue(e,{class:"q-virtual-scroll__padding",key:"before",ref:h,style:{[t]:`${m.value}px`,...o}}),ue(e,{class:"q-virtual-scroll__content",key:"content",ref:V,tabindex:-1},l.flat()),"tbody"===e?ue(e,{class:"q-virtual-scroll__padding",key:"after",ref:y},[ue("tr",[ue("td",{style:{[t]:`${S.value}px`,...o},colspan:b.value})])]):ue(e,{class:"q-virtual-scroll__padding",key:"after",ref:y,style:{[t]:`${S.value}px`,...o}})]},scrollTo:scrollTo,reset:reset,refresh:refresh}}const ge=l({name:"QField",inheritAttrs:!1,props:{...o,tag:{type:String,default:"label"}},emits:t,setup:()=>n(a({tagProp:!0}))}),he=l({name:"QMenu",inheritAttrs:!1,props:{...j,...c,...s,...r,persistent:Boolean,autoClose:Boolean,separateClosePopup:Boolean,noEscDismiss:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,fit:Boolean,cover:Boolean,square:Boolean,anchor:{type:String,validator:$},self:{type:String,validator:$},offset:{type:Array,validator:N},scrollTarget:u,touchPosition:Boolean,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null}},emits:[...i,"click","escapeKey"],setup(e,{slots:l,emit:t,attrs:o}){let n,a,i,u=null;const r=Z(),{proxy:s}=r,{$q:c}=s,k=ee(null),O=ee(!1),z=le((()=>!0!==e.persistent&&!0!==e.noRouteDismiss)),T=d(e,c),{registerTick:M,removeTick:P}=p(),{registerTimeout:A}=v();f(e);const{localScrollTarget:F,changeScrollEvent:E,unconfigureScrollTarget:q}=U(e,configureScrollTarget),{anchorEl:B,canShow:D}=W({showing:O}),{hide:H}=m({showing:O,canShow:D,handleShow:function(l){if(u=!1===e.noRefocus?document.activeElement:null,y(onFocusout),R(),configureScrollTarget(),n=void 0,void 0!==l&&(e.touchPosition||e.contextMenu)){const e=V(l);if(void 0!==e.left){const{top:l,left:t}=B.value.getBoundingClientRect();n={left:e.left-t,top:e.top-l}}}void 0===a&&(a=te((()=>c.screen.width+"|"+c.screen.height+"|"+e.self+"|"+e.anchor+"|"+c.lang.rtl),updatePosition));!0!==e.noFocus&&document.activeElement.blur();M((()=>{updatePosition(),!0!==e.noFocus&&focus()})),A((()=>{!0===c.platform.is.ios&&(i=e.autoClose,k.value.click()),updatePosition(),R(!0),t("show",l)}),e.transitionDuration)},handleHide:function(l){P(),L(),anchorCleanup(!0),null===u||void 0!==l&&!0===l.qClickOutside||(((0===l?.type.indexOf("key")?u.closest('[tabindex]:not([tabindex^="-"])'):void 0)||u).focus(),u=null);A((()=>{L(!0),t("hide",l)}),e.transitionDuration)},hideOnRouteChange:z,processOnMount:!0}),{showPortal:R,hidePortal:L,renderPortal:_}=S(),K={anchorEl:B,innerRef:k,onClickOutside(l){if(!0!==e.persistent&&!0===O.value)return H(l),("touchstart"===l.type||l.target.classList.contains("q-dialog__backdrop"))&&I(l),!0}},N=le((()=>X(e.anchor||(!0===e.cover?"center middle":"bottom start"),c.lang.rtl))),$=le((()=>!0===e.cover?N.value:X(e.self||"top start",c.lang.rtl)));le((()=>(!0===e.square?" q-menu--square":"")+(!0===T.value?" q-menu--dark q-dark":""))),le((()=>!0===e.autoClose?{onClick:onAutoClose}:{}));const j=le((()=>!0===O.value&&!0!==e.persistent));function focus(){x((()=>{let e=k.value;e&&!0!==e.contains(document.activeElement)&&(e=e.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||e.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||e.querySelector("[autofocus], [data-autofocus]")||e,e.focus({preventScroll:!0}))}))}function anchorCleanup(e){n=void 0,void 0!==a&&(a(),a=void 0),!0!==e&&!0!==O.value||(w(onFocusout),q(),Y(K),h(onEscapeKey)),!0!==e&&(u=null)}function configureScrollTarget(){null===B.value&&void 0===e.scrollTarget||(F.value=b(B.value,e.scrollTarget),E(F.value,updatePosition))}function onAutoClose(e){!0!==i?(G(s,e),t("click",e)):i=!1}function onFocusout(l){!0===j.value&&!0!==e.noFocus&&!0!==C(k.value,l.target)&&focus()}function onEscapeKey(l){!0!==e.noEscDismiss&&(t("escapeKey"),H(l))}function updatePosition(){J({targetEl:k.value,offset:e.offset,anchorEl:B.value,anchorOrigin:N.value,selfOrigin:$.value,absoluteOffset:n,fit:e.fit,cover:e.cover,maxHeight:e.maxHeight,maxWidth:e.maxWidth})}return te(j,(e=>{!0===e?(g(onEscapeKey),Q(K)):(h(onEscapeKey),Y(K))})),re(anchorCleanup),Object.assign(s,{focus:focus,updatePosition:updatePosition}),_}}),validateNewValueMode=e=>["add","add-unique","toggle"].includes(e),ye=Object.keys(o);function getPropValueFn(e,l){if("function"==typeof e)return e;const t=void 0!==e?e:l;return e=>null!==e&&"object"==typeof e&&t in e?e[t]:e}const Ve=l({name:"QSelect",inheritAttrs:!1,props:{...Se,...k,...o,modelValue:{required:!0},multiple:Boolean,displayValue:[String,Number],displayValueHtml:Boolean,dropdownIcon:String,options:{type:Array,default:()=>[]},optionValue:[Function,String],optionLabel:[Function,String],optionDisable:[Function,String],hideSelected:Boolean,hideDropdownIcon:Boolean,fillInput:Boolean,maxValues:[Number,String],optionsDense:Boolean,optionsDark:{type:Boolean,default:null},optionsSelectedClass:String,optionsHtml:Boolean,optionsCover:Boolean,menuShrink:Boolean,menuAnchor:String,menuSelf:String,menuOffset:Array,popupContentClass:String,popupContentStyle:[String,Array,Object],popupNoRouteDismiss:Boolean,useInput:Boolean,useChips:Boolean,newValueMode:{type:String,validator:validateNewValueMode},mapOptions:Boolean,emitValue:Boolean,disableTabSelection:Boolean,inputDebounce:{type:[Number,String],default:500},inputClass:[Array,String,Object],inputStyle:[Array,String,Object],tabindex:{type:[String,Number],default:0},autocomplete:String,transitionShow:{},transitionHide:{},transitionDuration:{},behavior:{type:String,validator:e=>["default","menu","dialog"].includes(e),default:"default"},virtualScrollItemSize:Se.virtualScrollItemSize.type,onNewValue:Function,onFilter:Function},emits:[...t,"add","remove","inputValue","keyup","keypress","keydown","popupShow","popupHide","filterAbort"],setup(e,{slots:l,emit:t}){const{proxy:o}=Z(),{$q:i}=o,u=ee(!1),r=ee(!1),s=ee(-1),c=ee(""),d=ee(!1),p=ee(!1);let v,f,m,S,g,h,y,V=null,w=null,b=null;const C=ee(null),x=ee(null),k=ee(null),N=ee(null),$=ee(null),j=O(e),U=T(onInput),W=le((()=>Array.isArray(e.options)?e.options.length:0)),X=le((()=>void 0===e.virtualScrollItemSize?!0===e.optionsDense?24:48:e.virtualScrollItemSize)),{virtualScrollSliceRange:Q,virtualScrollSliceSizeComputed:Y,localResetVirtualScroll:G,padVirtualScroll:J,onVirtualScrollEvt:ne,scrollTo:ae,setVirtualScrollSize:ie}=useVirtualScroll({virtualScrollLength:W,getVirtualScrollTarget:function(){return getVirtualScrollEl()},getVirtualScrollEl:getVirtualScrollEl,virtualScrollItemSizeComputed:X}),de=a(),pe=le((()=>{const l=!0===e.mapOptions&&!0!==e.multiple,t=void 0===e.modelValue||null===e.modelValue&&!0!==l?[]:!0===e.multiple&&Array.isArray(e.modelValue)?e.modelValue:[e.modelValue];if(!0===e.mapOptions&&!0===Array.isArray(e.options)){const o=!0===e.mapOptions&&void 0!==v?v:[],n=t.map((l=>function(l,t){const fn=e=>M(Ee.value(e),l);return e.options.find(fn)||t.find(fn)||l}(l,o)));return null===e.modelValue&&!0===l?n.filter((e=>null!==e)):n}return t})),ve=le((()=>{const l={};return ye.forEach((t=>{const o=e[t];void 0!==o&&(l[t]=o)})),l})),fe=le((()=>null===e.optionsDark?de.isDark.value:e.optionsDark)),me=le((()=>z(pe.value))),Se=le((()=>{let l="q-field__input q-placeholder col";return!0===e.hideSelected||0===pe.value.length?[l,e.inputClass]:(l+=" q-field__input--padding",void 0===e.inputClass?l:[l,e.inputClass])})),Ve=le((()=>(!0===e.virtualScrollHorizontal?"q-virtual-scroll--horizontal":"")+(e.popupContentClass?" "+e.popupContentClass:""))),we=le((()=>0===W.value)),be=le((()=>pe.value.map((e=>qe.value(e))).join(", "))),Ce=le((()=>void 0!==e.displayValue?e.displayValue:be.value)),xe=le((()=>!0===e.optionsHtml?()=>!0:e=>!0===e?.html)),Ie=le((()=>!0===e.displayValueHtml||void 0===e.displayValue&&(!0===e.optionsHtml||pe.value.some(xe.value)))),ke=le((()=>!0===de.focused.value?e.tabindex:-1)),Oe=le((()=>{const l={tabindex:e.tabindex,role:"combobox","aria-label":e.label,"aria-readonly":!0===e.readonly?"true":"false","aria-autocomplete":!0===e.useInput?"list":"none","aria-expanded":!0===u.value?"true":"false","aria-controls":`${de.targetUid.value}_lb`};return s.value>=0&&(l["aria-activedescendant"]=`${de.targetUid.value}_${s.value}`),l})),ze=le((()=>({id:`${de.targetUid.value}_lb`,role:"listbox","aria-multiselectable":!0===e.multiple?"true":"false"}))),Te=le((()=>pe.value.map(((e,l)=>({index:l,opt:e,html:xe.value(e),selected:!0,removeAtIndex:removeAtIndexAndFocus,toggleOption:toggleOption,tabindex:ke.value}))))),Me=le((()=>{if(0===W.value)return[];const{from:l,to:t}=Q.value;return e.options.slice(l,t).map(((t,o)=>{const n=!0===Be.value(t),a=!0===isOptionSelected(t),r=l+o,c={clickable:!0,active:a,activeClass:Fe.value,manualFocus:!0,focused:!1,disable:n,tabindex:-1,dense:e.optionsDense,dark:fe.value,role:"option","aria-selected":!0===a?"true":"false",id:`${de.targetUid.value}_${r}`,onClick:()=>{toggleOption(t)}};return!0!==n&&(s.value===r&&(c.focused=!0),!0===i.platform.is.desktop&&(c.onMousemove=()=>{!0===u.value&&setOptionIndex(r)})),{index:r,opt:t,html:xe.value(t),label:qe.value(t),selected:c.active,focused:c.focused,toggleOption:toggleOption,setOptionIndex:setOptionIndex,itemProps:c}}))})),Pe=le((()=>void 0!==e.dropdownIcon?e.dropdownIcon:i.iconSet.arrow.dropdown)),Ae=le((()=>!1===e.optionsCover&&!0!==e.outlined&&!0!==e.standout&&!0!==e.borderless&&!0!==e.rounded)),Fe=le((()=>void 0!==e.optionsSelectedClass?e.optionsSelectedClass:void 0!==e.color?`text-${e.color}`:"")),Ee=le((()=>getPropValueFn(e.optionValue,"value"))),qe=le((()=>getPropValueFn(e.optionLabel,"label"))),Be=le((()=>getPropValueFn(e.optionDisable,"disable"))),De=le((()=>pe.value.map(Ee.value))),He=le((()=>{const e={onInput:onInput,onChange:U,onKeydown:onTargetKeydown,onKeyup:onTargetAutocomplete,onKeypress:onTargetKeypress,onFocus:selectInputText,onClick(e){!0===f&&q(e)}};return e.onCompositionstart=e.onCompositionupdate=e.onCompositionend=U,e}));function getEmittingOptionValue(l){return!0===e.emitValue?Ee.value(l):l}function removeAtIndex(l){if(-1!==l&&l<pe.value.length)if(!0===e.multiple){const o=e.modelValue.slice();t("remove",{index:l,value:o.splice(l,1)[0]}),t("update:modelValue",o)}else t("update:modelValue",null)}function removeAtIndexAndFocus(e){removeAtIndex(e),de.focus()}function add(l,o){const n=getEmittingOptionValue(l);if(!0!==e.multiple)return!0===e.fillInput&&updateInputValue(qe.value(l),!0,!0),void t("update:modelValue",n);if(0===pe.value.length)return t("add",{index:0,value:n}),void t("update:modelValue",!0===e.multiple?[n]:n);if(!0===o&&!0===isOptionSelected(l))return;if(void 0!==e.maxValues&&e.modelValue.length>=e.maxValues)return;const a=e.modelValue.slice();t("add",{index:a.length,value:n}),a.push(n),t("update:modelValue",a)}function toggleOption(l,o){if(!0!==de.editable.value||void 0===l||!0===Be.value(l))return;const n=Ee.value(l);if(!0!==e.multiple)return!0!==o&&(updateInputValue(!0===e.fillInput?qe.value(l):"",!0,!0),hidePopup()),x.value?.focus(),void(0!==pe.value.length&&!0===M(Ee.value(pe.value[0]),n)||t("update:modelValue",!0===e.emitValue?n:l));if(!0===f&&!0!==d.value||de.focus(),selectInputText(),0===pe.value.length){const o=!0===e.emitValue?n:l;return t("add",{index:0,value:o}),void t("update:modelValue",!0===e.multiple?[o]:o)}const a=e.modelValue.slice(),i=De.value.findIndex((e=>M(e,n)));if(-1!==i)t("remove",{index:i,value:a.splice(i,1)[0]});else{if(void 0!==e.maxValues&&a.length>=e.maxValues)return;const o=!0===e.emitValue?n:l;t("add",{index:a.length,value:o}),a.push(o)}t("update:modelValue",a)}function setOptionIndex(e){if(!0!==i.platform.is.desktop)return;const l=-1!==e&&e<W.value?e:-1;s.value!==l&&(s.value=l)}function moveOptionSelection(l=1,t){if(!0===u.value){let o=s.value;do{o=F(o+l,-1,W.value-1)}while(-1!==o&&o!==s.value&&!0===Be.value(e.options[o]));s.value!==o&&(setOptionIndex(o),ae(o),!0!==t&&!0===e.useInput&&!0===e.fillInput&&setInputValue(o>=0?qe.value(e.options[o]):S,!0))}}function isOptionSelected(e){const l=Ee.value(e);return void 0!==De.value.find((e=>M(e,l)))}function selectInputText(l){!0===e.useInput&&null!==x.value&&(void 0===l||x.value===l.target&&l.target.value===be.value)&&x.value.select()}function onTargetKeyup(e){!0===B(e,27)&&!0===u.value&&(q(e),hidePopup(),resetInputValue()),t("keyup",e)}function onTargetAutocomplete(l){const{value:t}=l.target;if(void 0===l.keyCode)if(l.target.value="",null!==V&&(clearTimeout(V),V=null),null!==w&&(clearTimeout(w),w=null),resetInputValue(),"string"==typeof t&&0!==t.length){const l=t.toLocaleLowerCase(),findFn=t=>{const o=e.options.find((e=>String(t.value(e)).toLocaleLowerCase()===l));return void 0!==o&&(-1===pe.value.indexOf(o)?toggleOption(o):hidePopup(),!0)},fillFn=e=>{!0!==findFn(Ee)&&!0!==e&&!0!==findFn(qe)&&filter(t,!0,(()=>fillFn(!0)))};fillFn()}else de.clearValue(l);else onTargetKeyup(l)}function onTargetKeypress(e){t("keypress",e)}function onTargetKeydown(l){if(t("keydown",l),!0===P(l))return;const o=0!==c.value.length&&(void 0!==e.newValueMode||void 0!==e.onNewValue),n=!0!==l.shiftKey&&!0!==e.disableTabSelection&&!0!==e.multiple&&(-1!==s.value||!0===o);if(27===l.keyCode)return void A(l);if(9===l.keyCode&&!1===n)return void closeMenu();if(void 0===l.target||l.target.id!==de.targetUid.value||!0!==de.editable.value)return;if(40===l.keyCode&&!0!==de.innerLoading.value&&!1===u.value)return I(l),void showPopup();if(8===l.keyCode&&(!0===e.useChips||!0===e.clearable)&&!0!==e.hideSelected&&0===c.value.length)return void(!0===e.multiple&&!0===Array.isArray(e.modelValue)?removeAtIndex(e.modelValue.length-1):!0!==e.multiple&&null!==e.modelValue&&t("update:modelValue",null));35!==l.keyCode&&36!==l.keyCode||"string"==typeof c.value&&0!==c.value.length||(I(l),s.value=-1,moveOptionSelection(36===l.keyCode?1:-1,e.multiple)),33!==l.keyCode&&34!==l.keyCode||void 0===Y.value||(I(l),s.value=Math.max(-1,Math.min(W.value,s.value+(33===l.keyCode?-1:1)*Y.value.view)),moveOptionSelection(33===l.keyCode?1:-1,e.multiple)),38!==l.keyCode&&40!==l.keyCode||(I(l),moveOptionSelection(38===l.keyCode?-1:1,e.multiple));const a=W.value;if((void 0===h||y<Date.now())&&(h=""),a>0&&!0!==e.useInput&&void 0!==l.key&&1===l.key.length&&!1===l.altKey&&!1===l.ctrlKey&&!1===l.metaKey&&(32!==l.keyCode||0!==h.length)){!0!==u.value&&showPopup(l);const t=l.key.toLocaleLowerCase(),o=1===h.length&&h[0]===t;y=Date.now()+1500,!1===o&&(I(l),h+=t);const n=new RegExp("^"+h.split("").map((e=>-1!==".*+?^${}()|[]\\".indexOf(e)?"\\"+e:e)).join(".*"),"i");let i=s.value;if(!0===o||i<0||!0!==n.test(qe.value(e.options[i])))do{i=F(i+1,-1,a-1)}while(i!==s.value&&(!0===Be.value(e.options[i])||!0!==n.test(qe.value(e.options[i]))));s.value!==i&&oe((()=>{setOptionIndex(i),ae(i),i>=0&&!0===e.useInput&&!0===e.fillInput&&setInputValue(qe.value(e.options[i]),!0)}))}else if(13===l.keyCode||32===l.keyCode&&!0!==e.useInput&&""===h||9===l.keyCode&&!1!==n)if(9!==l.keyCode&&I(l),-1!==s.value&&s.value<a)toggleOption(e.options[s.value]);else{if(!0===o){const done=(l,t)=>{if(t){if(!0!==validateNewValueMode(t))return}else t=e.newValueMode;if(updateInputValue("",!0!==e.multiple,!0),null==l)return;("toggle"===t?toggleOption:add)(l,"add-unique"===t),!0!==e.multiple&&(x.value?.focus(),hidePopup())};if(void 0!==e.onNewValue?t("newValue",c.value,done):done(c.value),!0!==e.multiple)return}!0===u.value?closeMenu():!0!==de.innerLoading.value&&showPopup()}}function getVirtualScrollEl(){return!0===f?$.value:null!==k.value&&null!==k.value.contentEl?k.value.contentEl:void 0}function getAllOptions(){if(!0===we.value)return void 0!==l["no-option"]?l["no-option"]({inputValue:c.value}):void 0;const e=void 0!==l.option?l.option:e=>ue(L,{key:e.index,...e.itemProps},(()=>ue(H,(()=>ue(R,(()=>ue("span",{[!0===e.html?"innerHTML":"textContent"]:e.label})))))));let t=J("div",Me.value.map(e));return void 0!==l["before-options"]&&(t=l["before-options"]().concat(t)),_(l["after-options"],t)}function onInput(l){null!==V&&(clearTimeout(V),V=null),null!==w&&(clearTimeout(w),w=null),l&&l.target&&!0===l.target.qComposing||(setInputValue(l.target.value||""),m=!0,S=c.value,!0===de.focused.value||!0===f&&!0!==d.value||de.focus(),void 0!==e.onFilter&&(V=setTimeout((()=>{V=null,filter(c.value)}),e.inputDebounce)))}function setInputValue(l,o){c.value!==l&&(c.value=l,!0===o||0===e.inputDebounce||"0"===e.inputDebounce?t("inputValue",l):w=setTimeout((()=>{w=null,t("inputValue",l)}),e.inputDebounce))}function updateInputValue(l,t,o){m=!0!==o,!0===e.useInput&&(setInputValue(l,!0),!0!==t&&!0===o||(S=l),!0!==t&&filter(l))}function filter(l,n,a){if(void 0===e.onFilter||!0!==n&&!0!==de.focused.value)return;!0===de.innerLoading.value?t("filterAbort"):(de.innerLoading.value=!0,p.value=!0),""!==l&&!0!==e.multiple&&0!==pe.value.length&&!0!==m&&l===qe.value(pe.value[0])&&(l="");const i=setTimeout((()=>{!0===u.value&&(u.value=!1)}),10);null!==b&&clearTimeout(b),b=i,t("filter",l,((e,l)=>{!0!==n&&!0!==de.focused.value||b!==i||(clearTimeout(b),"function"==typeof e&&e(),p.value=!1,oe((()=>{de.innerLoading.value=!1,!0===de.editable.value&&(!0===n?!0===u.value&&hidePopup():!0===u.value?updateMenu(!0):u.value=!0),"function"==typeof l&&oe((()=>{l(o)})),"function"==typeof a&&oe((()=>{a(o)}))})))}),(()=>{!0===de.focused.value&&b===i&&(clearTimeout(b),de.innerLoading.value=!1,p.value=!1),!0===u.value&&(u.value=!1)}))}function onMenuBeforeHide(e){onControlPopupHide(e),closeMenu()}function onMenuShow(){ie()}function onDialogFieldFocus(e){q(e),x.value?.focus(),d.value=!0,window.scrollTo(window.pageXOffset||window.scrollX||document.body.scrollLeft||0,0)}function onDialogFieldBlur(e){q(e),oe((()=>{d.value=!1}))}function onDialogBeforeHide(e){onControlPopupHide(e),null!==N.value&&N.value.__updateRefocusTarget(de.rootRef.value.querySelector(".q-field__native > [tabindex]:last-child")),de.focused.value=!1}function onDialogHide(e){hidePopup(),!1===de.focused.value&&t("blur",e),resetInputValue()}function onDialogShow(){const e=document.activeElement;null!==e&&e.id===de.targetUid.value||null===x.value||x.value===e||x.value.focus(),ie()}function closeMenu(){!0!==r.value&&(s.value=-1,!0===u.value&&(u.value=!1),!1===de.focused.value&&(null!==b&&(clearTimeout(b),b=null),!0===de.innerLoading.value&&(t("filterAbort"),de.innerLoading.value=!1,p.value=!1)))}function showPopup(t){!0===de.editable.value&&(!0===f?(de.onControlFocusin(t),r.value=!0,oe((()=>{de.focus()}))):de.focus(),void 0!==e.onFilter?filter(c.value):!0===we.value&&void 0===l["no-option"]||(u.value=!0))}function hidePopup(){r.value=!1,closeMenu()}function resetInputValue(){!0===e.useInput&&updateInputValue(!0!==e.multiple&&!0===e.fillInput&&0!==pe.value.length&&qe.value(pe.value[0])||"",!0,!0)}function updateMenu(l){let t=-1;if(!0===l){if(0!==pe.value.length){const l=Ee.value(pe.value[0]);t=e.options.findIndex((e=>M(Ee.value(e),l)))}G(t)}setOptionIndex(t)}function updateMenuPosition(){!1===r.value&&null!==k.value&&k.value.updatePosition()}function onControlPopupShow(e){void 0!==e&&q(e),t("popupShow",e),de.hasPopupOpen=!0,de.onControlFocusin(e)}function onControlPopupHide(e){void 0!==e&&q(e),t("popupHide",e),de.hasPopupOpen=!1,de.onControlFocusout(e)}function updatePreState(){f=(!0===i.platform.is.mobile||"dialog"===e.behavior)&&("menu"!==e.behavior&&(!0!==e.useInput||(void 0!==l["no-option"]||void 0!==e.onFilter||!1===we.value))),g=!0===i.platform.is.ios&&!0===f&&!0===e.useInput?"fade":e.transitionShow}return te(pe,(l=>{v=l,!0===e.useInput&&!0===e.fillInput&&!0!==e.multiple&&!0!==de.innerLoading.value&&(!0!==r.value&&!0!==u.value||!0!==me.value)&&(!0!==m&&resetInputValue(),!0!==r.value&&!0!==u.value||filter(""))}),{immediate:!0}),te((()=>e.fillInput),resetInputValue),te(u,updateMenu),te(W,(function(e,l){!0===u.value&&!1===de.innerLoading.value&&(G(-1,!0),oe((()=>{!0===u.value&&!1===de.innerLoading.value&&(e>l?G():updateMenu(!0))})))})),se(updatePreState),ce(updateMenuPosition),updatePreState(),re((()=>{null!==V&&clearTimeout(V),null!==w&&clearTimeout(w)})),Object.assign(o,{showPopup:showPopup,hidePopup:hidePopup,removeAtIndex:removeAtIndex,add:add,toggleOption:toggleOption,getOptionIndex:()=>s.value,setOptionIndex:setOptionIndex,moveOptionSelection:moveOptionSelection,filter:filter,updateMenuPosition:updateMenuPosition,updateInputValue:updateInputValue,isOptionSelected:isOptionSelected,getEmittingOptionValue:getEmittingOptionValue,isOptionDisabled:(...e)=>!0===Be.value.apply(null,e),getOptionValue:(...e)=>Ee.value.apply(null,e),getOptionLabel:(...e)=>qe.value.apply(null,e)}),Object.assign(de,{innerValue:pe,fieldClass:le((()=>`q-select q-field--auto-height q-select--with${!0!==e.useInput?"out":""}-input q-select--with${!0!==e.useChips?"out":""}-chips q-select--`+(!0===e.multiple?"multiple":"single"))),inputRef:C,targetRef:x,hasValue:me,showPopup:showPopup,floatingLabel:le((()=>!0!==e.hideSelected&&!0===me.value||"number"==typeof c.value||0!==c.value.length||z(e.displayValue))),getControlChild:()=>{if(!1!==de.editable.value&&(!0===r.value||!0!==we.value||void 0!==l["no-option"]))return!0===f?function(){const t=[ue(ge,{class:`col-auto ${de.fieldClass.value}`,...ve.value,for:de.targetUid.value,dark:fe.value,square:!0,loading:p.value,itemAligned:!1,filled:!0,stackLabel:0!==c.value.length,...de.splitAttrs.listeners.value,onFocus:onDialogFieldFocus,onBlur:onDialogFieldBlur},{...l,rawControl:()=>de.getControl(!0),before:void 0,after:void 0})];return!0===u.value&&t.push(ue("div",{ref:$,class:Ve.value+" scroll",style:e.popupContentStyle,...ze.value,onClick:A,onScrollPassive:ne},getAllOptions())),ue(D,{ref:N,modelValue:r.value,position:!0===e.useInput?"top":void 0,transitionShow:g,transitionHide:e.transitionHide,transitionDuration:e.transitionDuration,noRouteDismiss:e.popupNoRouteDismiss,onBeforeShow:onControlPopupShow,onBeforeHide:onDialogBeforeHide,onHide:onDialogHide,onShow:onDialogShow},(()=>ue("div",{class:"q-select__dialog"+(!0===fe.value?" q-select__dialog--dark q-dark":"")+(!0===d.value?" q-select__dialog--focused":"")},t)))}():ue(he,{ref:k,class:Ve.value,style:e.popupContentStyle,modelValue:u.value,fit:!0!==e.menuShrink,cover:!0===e.optionsCover&&!0!==we.value&&!0!==e.useInput,anchor:e.menuAnchor,self:e.menuSelf,offset:e.menuOffset,dark:fe.value,noParentEvent:!0,noRefocus:!0,noFocus:!0,noRouteDismiss:e.popupNoRouteDismiss,square:Ae.value,transitionShow:e.transitionShow,transitionHide:e.transitionHide,transitionDuration:e.transitionDuration,separateClosePopup:!0,...ze.value,onScrollPassive:ne,onBeforeShow:onControlPopupShow,onBeforeHide:onMenuBeforeHide,onShow:onMenuShow},getAllOptions);!0===de.hasPopupOpen&&(de.hasPopupOpen=!1)},controlEvents:{onFocusin(e){de.onControlFocusin(e)},onFocusout(e){de.onControlFocusout(e,(()=>{resetInputValue(),closeMenu()}))},onClick(e){if(A(e),!0!==f&&!0===u.value)return closeMenu(),void x.value?.focus();showPopup(e)}},getControl:t=>{const o=!0===e.hideSelected?[]:void 0!==l["selected-item"]?Te.value.map((e=>l["selected-item"](e))).slice():void 0!==l.selected?[].concat(l.selected()):!0===e.useChips?Te.value.map(((l,t)=>ue(K,{key:"option-"+t,removable:!0===de.editable.value&&!0!==Be.value(l.opt),dense:!0,textColor:e.color,tabindex:ke.value,onRemove(){l.removeAtIndex(t)}},(()=>ue("span",{class:"ellipsis",[!0===l.html?"innerHTML":"textContent"]:qe.value(l.opt)}))))):[ue("span",{class:"ellipsis",[!0===Ie.value?"innerHTML":"textContent"]:Ce.value})],n=!0===t||!0!==r.value||!0!==f;if(!0===e.useInput)o.push(function(l,t){const o=!0===t?{...Oe.value,...de.splitAttrs.attributes.value}:void 0,n={ref:!0===t?x:void 0,key:"i_t",class:Se.value,style:e.inputStyle,value:void 0!==c.value?c.value:"",type:"search",...o,id:!0===t?de.targetUid.value:void 0,maxlength:e.maxlength,autocomplete:e.autocomplete,"data-autofocus":!0===l||!0===e.autofocus||void 0,disabled:!0===e.disable,readonly:!0===e.readonly,...He.value};return!0!==l&&!0===f&&(!0===Array.isArray(n.class)?n.class=[...n.class,"no-pointer-events"]:n.class+=" no-pointer-events"),ue("input",n)}(t,n));else if(!0===de.editable.value){const l=!0===n?Oe.value:void 0;o.push(ue("input",{ref:!0===n?x:void 0,key:"d_t",class:"q-select__focus-target",id:!0===n?de.targetUid.value:void 0,value:Ce.value,readonly:!0,"data-autofocus":!0===t||!0===e.autofocus||void 0,...l,onKeydown:onTargetKeydown,onKeyup:onTargetKeyup,onKeypress:onTargetKeypress})),!0===n&&"string"==typeof e.autocomplete&&0!==e.autocomplete.length&&o.push(ue("input",{class:"q-select__autocomplete-input",autocomplete:e.autocomplete,tabindex:-1,onKeyup:onTargetAutocomplete}))}if(void 0!==j.value&&!0!==e.disable&&0!==De.value.length){const l=De.value.map((e=>ue("option",{value:e,selected:!0})));o.push(ue("select",{class:"hidden",name:j.value,multiple:e.multiple},l))}const a=!0===e.useInput||!0!==n?void 0:de.splitAttrs.attributes.value;return ue("div",{class:"q-field__native row items-center",...a,...de.splitAttrs.listeners.value},o)},getInnerAppend:()=>!0!==e.loading&&!0!==p.value&&!0!==e.hideDropdownIcon?[ue(E,{class:"q-select__dropdown-icon"+(!0===u.value?" rotate-180":""),name:Pe.value})]:null}),n(de)}});export{Ve as _,useVirtualScroll as a,me as c,Se as u};
//# sourceMappingURL=QSelect.mjs.map
